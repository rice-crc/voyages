{% load i18n %}
{% load assessment_extras %}

<script src="{{ STATIC_URL }}scripts/assessment/assessment-left-menu.js" type="text/javascript"></script>
<script src="{{ STATIC_URL }}scripts/navigation_boxes.js" type="text/javascript"></script>

    <input type="hidden" value="time-frame" name="form:_idJsp6_selected">
    <div class="sidebar-section">
      <div class="sidebar-title-2">
        {% trans 'Time frame' %}
      </div>
    </div>
    <div id="form:_idJsp7" class="box-main-text">
      {% trans 'Show data only from' %}
      {{ year_form.frame_from_year }}
      {% trans 'to' %}
      {{ year_form.frame_to_year }}

      {% trans 'The full extent of time covered by estimates is 1501 â€“ 1866.' %}
      <button type="submit" name="submit_year" value="Change selection">{% trans 'Change selection' %}</button>
      <button type="submit" name="submit_year" value="Reset to default">{% trans 'Reset to default' %}</button>
    </div>

    <div class="sidebar-section">
      <div class="sidebar-title-2">
        {% trans 'Flag' %}
      </div>

      {% for nation in nations %}
        {% ifequal nation.2 1 %}
          <input id="form:checkbox_nation_{{ nation.1 }}" type="checkbox" checked="checked" value="1" name="checkbox_nation_{{ nation.1 }}">
        {% else %}
          <input id="form:checkbox_nation_{{ nation.1 }}" type="checkbox" name="checkbox_nation_{{ nation.1 }}">
        {% endifequal %}
        <label for="form:checkbox_nation_{{ nation.1 }}">{{ nation.0|trans_log }}</label>
      {% endfor %}

      <button type="submit" name="submit_nation" value="Change selection" name="submit_regions">{% trans 'Change selection' %}</button>
      <button type="submit" name="submit_nation" type="submit" value="Reset to default" name="submit_regions">{% trans 'Reset to default' %}</button>
    </div>



    <div class="sidebar-section">
      <div class="sidebar-title-2">
        {% trans 'Embarkation/Disembarkation' %}
      </div>




      <div id="form:_idJsp34" class="box-main-text">

        <div class="region-list">
          <div class="region-title">{% trans 'Embarkation regions' %}</div>

          <!-- Embkarkation menu -->
          <table>
          <tbody>
            {% for area, region_list in export_regions.items %}
            <tr id="row-{{ area.0.pk }}" class="checkbox-list-item-0">

              <!-- Checkbox on the left of label -->
              <td class="checkbox-list-checkbox-0" style="position: relative;">
                {% ifequal area.1 1 %}
                  <input type="checkbox" checked="checked" value="{{ area.0.pk }}" name="earea-button-{{ area.0.pk }}" onclick="areaClick(this)">
                {% else %}
                  <input type="checkbox" value="{{ area.0.pk }}" name="earea-button-{{ area.0.pk }}" onclick="areaClick(this)">
                {% endifequal %}
              </td>

              <!-- Check if item is expendable and use proper class -->
              {% if region_list|length == 1 and region_list.0.0.0 == area.0.name %}
                <td class="checkbox-list-label-0">
                  <label onclick="labelClick(this, 0)">{{ area.0.name|trans_log }}</label>
                </td>
              {% elif region_list %}
                <td class="checkbox-list-label-0-expandable">
                  <label onclick="labelClick(this, 0)">{{ area.0.name|trans_log }}</label>
                </td>
              {% else %}
                <td class="checkbox-list-label-0">
                  <label onclick="labelClick(this, 0)">{{ area.0.name|trans_log }}</label>
                </td>
              {% endif %}

              <!-- Check if item is expendable, if so, third td exists -->
              <td>
              {% if region_list|length == 1 and region_list.0.0.0 == area.0.name %}
              {% elif not region_list %}
              {% else %}
                <div class="checkbox-list-popup" style="position: absolute; display: none">
                  <table class="checkbox-list-table-1" cellspacing="0" cellpadding="0" border="0">
                  <tbody>
                    {%  for region in region_list %}
                    <tr class="checkbox-list-item-0" >
                      <td class="checkbox-list-checkbox-0">
                        {% ifequal region.1 1 %}
                          <input name="eregion-button-{{ region.0.1 }}" type="checkbox" checked="checked" value="{{ region.0.1 }}" onclick="regionClick(this, 'earea-button-', 'eregion-button-')">
                        {% else %}
                          <input name="eregion-button-{{ region.0.1 }}" type="checkbox" value="{{ region.0.1 }}" onclick="regionClick(this, 'earea-button-', 'eregion-button-')">
                        {% endifequal %}
                      </td>
                      <td class="checkbox-list-label-0">
                        <label onclick="labelClick(this, 1)">{{ region.0.0|trans_log }}</label>
                      </td>
                    </tr>
                    {% endfor %}
                  </tbody>
                  </table>
                </div>
              {% endif %}
              </td>
            </tr>
            {% endfor %}
          </tbody>
          </table>

          <!-- Select/Deselect all buttons -->
          <table class="checkbox-list-select-deselect-all" cellspacing="0" cellpadding="0" border="0">
          <tbody>
            <tr>
              <td class="checkbox-list-select-all">
                <button value="'Select all'" onclick="allClicked(this, 1)">{% trans 'Select all' %}</button>
              </td>
              <td class="checkbox-list-deselect-all">
                <button value="'Deselect all'" onclick="allClicked(this, 0)">{% trans 'Deselect all' %}</button>
              </td>
            </tr>
          </tbody>
          </table>
        </div>

        <div class="region-list">
          <!-- Disembarkation menu -->
          <div class="region-title">{% trans 'Disembarkation regions' %}</div>
          <table>
          <tbody>
            {% for area, region_list in import_regions.items %}
            <tr id="row-{{ area.pk }}" class="checkbox-list-item-0">

              <!-- Checkbox on the left of label -->
              <td class="checkbox-list-checkbox-0" style="position: relative;">
                {% ifequal area.1 1 %}
                  <input type="checkbox" checked="checked" value="{{ area.0.pk }}" name="darea-button-{{ area.0.pk }}" onclick="areaClick(this)">
                {% else %}
                  <input type="checkbox" value="{{ area.0.pk }}" name="darea-button-{{ area.0.pk }}" onclick="areaClick(this)">
                {% endifequal %}
              </td>

              <!-- Check if item is expendable and use proper class -->
              {% if region_list|length == 1 and region_list.0.0.0 == area.0.name %}
                <td class="checkbox-list-label-0">
                  <label onclick="labelClick(this, 0)">{{ area.0.name|trans_log }}</label>
                </td>
              {% elif region_list %}
                <td class="checkbox-list-label-0-expandable">
                  <label onclick="labelClick(this, 0)">{{ area.0.name|trans_log }}</label>
                </td>
              {% else %}
                <td class="checkbox-list-label-0">
                  <label onclick="labelClick(this, 0)">{{ area.0.name|trans_log }}</label>
                </td>
              {% endif %}

              <!-- Check if item is expendable, if so, third td exists -->
              <td>
              {% if region_list|length == 1 and region_list.0.0.0 == area.0.name %}
              {% elif not region_list %}
              {% else %}
                <div class="checkbox-list-popup" style="position: absolute; display: none">
                  <table class="checkbox-list-table-1" cellspacing="0" cellpadding="0" border="0">
                  <tbody>
                    {%  for region in region_list %}
                    <tr class="checkbox-list-item-0" >
                      <td class="checkbox-list-checkbox-0">
                        {% ifequal region.1 1 %}
                          <input name="dregion-button-{{ region.0.1 }}" type="checkbox" checked="checked" value="{{ region.0.1 }}" onclick="regionClick(this, 'darea-button-', 'dregion-button-')">
                        {% else %}
                          <input name="dregion-button-{{ region.0.1 }}" type="checkbox" value="{{ region.0.1 }}" onclick="regionClick(this, 'darea-button-', 'dregion-button-')">
                        {% endifequal %}
                      </td>
                      <td class="checkbox-list-label-0">
                        <label onclick="labelClick(this, 1)">{{ region.0.0|trans_log }}</label>
                      </td>
                    </tr>
                    {% endfor %}
                  </tbody>
                  </table>
                </div>
              {% endif %}
              </td>
            </tr>
            {% endfor %}
          </tbody>
          </table>
          <!-- Select/Deselect all buttons -->
          <table class="checkbox-list-select-deselect-all" cellspacing="0" cellpadding="0" border="0">
          <tbody>
            <tr>
              <td class="checkbox-list-select-all">
                <button value="'Select all'" onclick="allClicked(this, 1)">{% trans 'Select all' %}</button>
              </td>
              <td class="checkbox-list-deselect-all">
                <button value="'Deselect all'" onclick="allClicked(this, 0)">{% trans 'Deselect all' %}</button>
              </td>
            </tr>
          </tbody>
          </table>
        </div>

        <button type="submit" value="Change selection" name="submit_regions">{% trans 'Change selection' %}</button>
        <button type="submit" value="Reset to default" name="submit_regions">{% trans 'Reset to default' %}</button>

      </div>


    </div>








  <table>
  <tbody>
    <tr>
      <td class="box-upper-row-left"></td>
      <td class="box-upper-row-middle">
        <input type="hidden" value="expanded" name="form:_idJsp45_state">
        <table class="box-header-table" cellspacing="0" cellpadding="0" border="0">
        <tbody>
          <tr>
            <td class="box-label">{% trans 'Current query' %}</td>
            <td>
              <div class="box-button"></div>
            </td>
          </tr>
        </tbody>
        </table>
      </td>
      <td class="box-upper-row-right"></td>
    </tr>
    <tr class="row">
      <td class="box-middle-row-left">
        <div class="box-middle-row-left"></div>
      </td>
      <td class="box-middle-row-middle">
        <div id="form:_idJsp45" class="box-main-text">
          <div>
            <div style="font-weight: bold;">{% trans 'Selected national carriers:' %}</div>
            <i>
              {% if all_nations_selected %}
                {% trans 'all' %}
              {% else %}
                {% for nation in nations %}
                  {% ifequal nation.2 1 %}
                    {{ nation.0|trans_log }}<br/>
                  {% endifequal %}
                {% endfor %}
              {% endif %}
            </i>
          </div>
          <div style="margin-top: 5px;">
            <div style="font-weight: bold;">{% trans 'Selected embarkation regions:' %}</div>
            <i>
              {% if all_embarkations_selected %}
                {% trans 'all' %}
              {% else %}
                {% for region_list in export_regions.values %}
                  {% for region in region_list %}
                    {% ifequal region.1 1 %}
                      {{ region.0.0|trans_log }}<br/>
                    {% endifequal %}
                  {% endfor %}
                {% endfor %}
              {% endif %}
            </i>
          </div>
          <div style="margin-top: 5px;">
            <div style="font-weight: bold;">{% trans 'Selected disembarkation regions:' %}</div>
            <i>
              {% if all_disembarkations_selected %}
                {% trans 'all' %}
              {% else %}
                {% for region_list in import_regions.values %}
                  {% for region in region_list %}
                    {% ifequal region.1 1 %}
                      {{ region.0.0|trans_log }}<br/>
                    {% endifequal %}
                  {% endfor %}
                {% endfor %}
              {% endif %}
            </i>
          </div>
          <div style="margin-top: 5px;">
            <button onclick="return createLink();">{% trans 'Create a link' %}</button> <br/>
            <button onclick="return resetAll();">{% trans 'New query' %}</button>
          </div>
        </div>
      </td>
      <td class="box-middle-row-right">
        <div class="box-middle-row-right"></div>
      </td>
    </tr>
    <tr class="row">
      <td class="box-lower-row-left"></td>
      <td class="box-lower-row-middle"></td>
      <td class="box-lower-row-right"></td>
    </tr>
  </tbody>
  </table>

  <p style="font-style: italic;margin: 10px 10px 0px 10px;">{% trans 'For purposes of calculation, estimates of embarked and disembarked slaves in tables, the timeline, and maps have been rounded to integers. When users cite any number, they are advised to round it to the nearest hundred.' %}</p>
  <div id="dialog" title="Dialog Title" style="display:none;">
    <div class="page-title-1">{% trans 'URL link has been created' %}</div>
    <hr />
    <p>{% trans 'To reactivate the current query in the future, copy the following URL and then paste it into the address bar:' %}</p>
    <textarea contenteditable="true" id="url_string" style="width:500px;"></textarea>
  </div>

  <link rel="stylesheet" href="//code.jquery.com/ui/1.11.4/themes/smoothness/jquery-ui.css">
  <script src="//code.jquery.com/ui/1.11.4/jquery-ui.js"></script>
  <script type="text/javascript">
    $( "#dialog" ).dialog({ autoOpen: false, minWidth: 550, modal: true, title: "{% trans 'Link created' %}" });
    function createLink() {
      $.post('permalink', $('form').serialize(), function(link) {
        var urlTextArea = $('#url_string');
        urlTextArea.val(link);
        urlTextArea.focus(function(e) {
          e.target.select();
          try {
            document.execCommand('copy');
          } catch (e) {
            console.log('Unable to copy to clipboard using document.execCommand');
          }
          jQuery(e.target).one('mouseup', function(e) {
            e.preventDefault();
          });
        });
        $("#dialog").dialog('open');
      });
      return false;
    }

    function resetAll() {
      var helper = function(name) {
        var input = $("<input>")
          .attr("type", "hidden")
          .attr("name", name)
          .val("Reset to default");
        $('form').append($(input));
      }
      helper('submit_year');
      helper('submit_nation');
      helper('submit_regions');
      helper('table_options');
      $('form').submit();
      return false;
    }
  </script>
