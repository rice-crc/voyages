{% load i18n %}

<script src="{{ STATIC_URL }}scripts/assessment/assessment-left-menu.js" type="text/javascript"></script>
<script src="{{ STATIC_URL }}scripts/navigation_boxes.js" type="text/javascript"></script>

<div style="margin: 10px 10px 0px 10px;">
  <div>
    <input type="hidden" value="time-frame" name="form:_idJsp6_selected">

    <table class="box-main-table" cellspacing="0" cellpadding="0" border="0">
    <tbody>
      <tr>
        <td class="box-set-upper-row-upper-left"></td>
        <td class="box-set-upper-row-upper-middle">
          <table class="box-header-table" cellspacing="0" cellpadding="0" border="0">
          <tbody>
            <tr>
              <td class="box-label">
                Time frame
              </td>
              <td>
                <div class="box-button"></div>
              </td>
            </tr>
          </tbody>
          </table>
        </td>
        <td class="box-set-upper-row-upper-right"></td>
      </tr>
      <tr class="row">
        <td class="box-middle-row-left">
          <div class="box-middle-row-left"></div>
        </td>
        <td class="box-middle-row-middle">
          <div id="form:_idJsp7" class="box-main-text">
            <table style="border-collapse: collapse;">
            <tbody>
              <tr>
                <td style="padding: 0px 10px 0px 0px">
                  Show data only from
                </td>
                <td style="padding: 0px 10px 0px 0px;">
                  {{ year_form.frame_from_year }}
                </td>
                <td style="padding: 0px 10px 0px 0px;">
                  to
                </td>
                <td style="padding: 0px;">
                {{ year_form.frame_to_year }}
                </td>
              </tr>
            </tbody>
            </table>
            <div style="padding: 5px 0px 0px 0px; font-style: italic;">
              The full extent of time covered by estimates is 1501 â€“ 1866.
            </div>
            <div style="margin-top: 10px; padding-top: 10px; border-top: 1px solid #9EDEE0;">
              <input id="submit_year" type="submit" value="Change selection" name="submit_year">
              <input id="submit_year" type="submit" value="Reset to default" name="submit_year">
            </div>
          </div>
        </td>
        <td class="box-middle-row-right">
          <div class="box-middle-row-right"></div>
        </td>
      </tr>
      <tr class="row">
        <td class="box-set-lower-row-upper-left"></td>
        <td class="box-set-lower-row-upper-middle"></td>
        <td class="box-set-lower-row-upper-right"></td>
      </tr>
    </tbody>
    </table>

    <table class="box-main-table" cellspacing="0" cellpadding="0" border="0">
    <tbody>
      <tr>
        <td class="box-set-upper-row-middle-left"></td>
        <td class="box-set-upper-row-middle-middle">
          <table class="box-header-table" cellspacing="0" cellpadding="0" border="0">
          <tbody>
            <tr>
              <td class="box-label">Flag</td>
              <td>
                <div class="box-button-collapsed"></div>
              </td>
            </tr>
          </tbody>
          </table>
        </td>
        <td class="box-set-upper-row-middle-right"></td>
      </tr>
      <tr class="row-collapsed">
        <td class="box-middle-row-left">
          <div class="box-middle-row-left"></div>
        </td>
        <td class="box-middle-row-middle">
          <div id="form:_idJsp28" class="box-main-text">
            <div class="nation-checkboxes">
              <input type="hidden" value="" name="form:nations_expanded_values">
                <table class="checkbox-list-table-0" cellspacing="0" cellpadding="0" border="0">
                <tbody>
                  {% for nation in nations %}
                    <tr>
                      {% ifequal nation.2 1 %}
                      <td class="checkbox-list-checkbox-0">
                        <input id="form:checkbox_nation_{{ nation.1 }}" type="checkbox" checked="checked" value="1" name="checkbox_nation_{{ nation.1 }}">
                      </td>
                      {% else %}
                        <td class="checkbox-list-checkbox-0">
                          <input id="form:checkbox_nation_{{ nation.1 }}" type="checkbox" name="checkbox_nation_{{ nation.1 }}">
                        </td>
                      {% endifequal %}
                      <td class="checkbox-list-label-0">
                        <label for="form:checkbox_nation_{{ nation.1 }}">{{ nation.0 }}</label>
                      </td>
                    </tr>
                  {% endfor %}
                </tbody>
                </table>

              <div style="margin-top: 10px; padding-top: 10px; border-top: 1px solid #9EDEE0;">
                <input id="submit_nation" type="submit" onclick="clear_form();" value="Change selection" name="submit_nation">
                <input id="submit_nation" type="submit" onclick="clear_form();" value="Reset to default" name="submit_nation">
              </div>
            </div>
          </div>
        </td>

        <td class="box-middle-row-right">
          <div class="box-middle-row-right"></div>
        </td>
      </tr>
      <tr class="row-collapsed">
        <td class="box-set-lower-row-middle-left"></td>
        <td class="box-set-lower-row-middle-middle"></td>
        <td class="box-set-lower-row-middle-right"></td>
      </tr>
    </tbody>
    </table>

    <table class="box-main-table" cellspacing="0" cellpadding="0" border="0">
    <tbody>
      <tr>
        <td class="box-set-upper-row-bottom-left"></td>
        <td class="box-set-upper-row-bottom-middle">
          <table class="box-header-table" cellspacing="0" cellpadding="0" border="0">
          <tbody>
            <tr>
              <td class="box-label">Embarkation/Disembarkation</td>
              <td>
                <div class="box-button-collapsed"></div>
              </td>
            </tr>
          </tbody>
          </table>
        </td>
        <td class="box-set-upper-row-bottom-right"></td>
      </tr>
      <tr class="row-collapsed">
        <td class="box-middle-row-left">
          <div class="box-middle-row-left"></div>
        </td>
        <td class="box-middle-row-middle">
          <div id="form:_idJsp34" class="box-main-text">

            <div class="region-list">
              <div class="region-title">Embarkation regions</div>

              <!-- Embkarkation menu -->
              <table class="checkbox-list-table-0" cellspacing="0" cellpadding="0" border="0">
              <tbody>
                {% for area, region_list in export_regions.items %}
                <tr id="row-{{ area.0.pk }}" class="checkbox-list-item-0">

                  <!-- Checkbox on the left of label -->
                  <td class="checkbox-list-checkbox-0" style="position: relative;">
                    {% ifequal area.1 1 %}
                      <input type="checkbox" checked="checked" value="{{ area.0.pk }}" name="earea-button-{{ area.0.pk }}" onclick="areaClick(this)">
                    {% else %}
                      <input type="checkbox" value="{{ area.0.pk }}" name="earea-button-{{ area.0.pk }}" onclick="areaClick(this)">
                    {% endifequal %}
                  </td>

                  <!-- Check if item is expendable and use proper class -->
                  {% if region_list|length == 1 and region_list.0.0.0 == area.0.name %}
                    <td class="checkbox-list-label-0">
                      <label onclick="labelClick(this, 0)">{{ area.0.name }}</label>
                    </td>
                  {% elif region_list %}
                    <td class="checkbox-list-label-0-expandable">
                      <label onclick="labelClick(this, 0)">{{ area.0.name }}</label>
                    </td>
                  {% else %}
                    <td class="checkbox-list-label-0">
                      <label onclick="labelClick(this, 0)">{{ area.0.name }}</label>
                    </td>
                  {% endif %}

                  <!-- Check if item is expendable, if so, third td exists -->
                  <td>
                  {% if region_list|length == 1 and region_list.0.0.0 == area.0.name %}
                  {% elif not region_list %}
                  {% else %}
                    <div class="checkbox-list-popup" style="position: absolute; display: none">
                      <table class="checkbox-list-table-1" cellspacing="0" cellpadding="0" border="0">
                      <tbody>
                        {%  for region in region_list %}
                        <tr class="checkbox-list-item-0" >
                          <td class="checkbox-list-checkbox-0">
                            {% ifequal region.1 1 %}
                              <input name="eregion-button-{{ region.0.1 }}" type="checkbox" checked="checked" value="{{ region.0.1 }}" onclick="regionClick(this, 'earea-button-', 'eregion-button-')">
                            {% else %}
                              <input name="eregion-button-{{ region.0.1 }}" type="checkbox" value="{{ region.0.1 }}" onclick="regionClick(this, 'earea-button-', 'eregion-button-')">
                            {% endifequal %}
                          </td>
                          <td class="checkbox-list-label-0">
                            <label onclick="labelClick(this, 1)">{{ region.0.0 }}</label>
                          </td>
                        </tr>
                        {% endfor %}
                      </tbody>
                      </table>
                    </div>
                  {% endif %}
                  </td>
                </tr>
                {% endfor %}
              </tbody>
              </table>

              <!-- Select/Deselect all buttons -->
              <table class="checkbox-list-select-deselect-all" cellspacing="0" cellpadding="0" border="0">
              <tbody>
                <tr>
                  <td class="checkbox-list-select-all">
                    <input type="button" value="Select all" onclick="allClicked(this, 1)">
                  </td>
                  <td class="checkbox-list-deselect-all">
                    <input type="button" value="Deselect all" onclick="allClicked(this, 0)">
                  </td>
                </tr>
              </tbody>
              </table>
            </div>

            <div class="region-list">
              <!-- Disembarkation menu -->
              <div class="region-title">Disembarkation regions</div>
              <table class="checkbox-list-table-0" cellspacing="0" cellpadding="0" border="0">
              <tbody>
                {% for area, region_list in import_regions.items %}
                <tr id="row-{{ area.pk }}" class="checkbox-list-item-0">

                  <!-- Checkbox on the left of label -->
                  <td class="checkbox-list-checkbox-0" style="position: relative;">
                    {% ifequal area.1 1 %}
                      <input type="checkbox" checked="checked" value="{{ area.0.pk }}" name="darea-button-{{ area.0.pk }}" onclick="areaClick(this)">
                    {% else %}
                      <input type="checkbox" value="{{ area.0.pk }}" name="darea-button-{{ area.0.pk }}" onclick="areaClick(this)">
                    {% endifequal %}
                  </td>

                  <!-- Check if item is expendable and use proper class -->
                  {% if region_list|length == 1 and region_list.0.0.0 == area.0.name %}
                    <td class="checkbox-list-label-0">
                      <label onclick="labelClick(this, 0)">{{ area.0.name }}</label>
                    </td>
                  {% elif region_list %}
                    <td class="checkbox-list-label-0-expandable">
                      <label onclick="labelClick(this, 0)">{{ area.0.name }}</label>
                    </td>
                  {% else %}
                    <td class="checkbox-list-label-0">
                      <label onclick="labelClick(this, 0)">{{ area.0.name }}</label>
                    </td>
                  {% endif %}

                  <!-- Check if item is expendable, if so, third td exists -->
                  <td>
                  {% if region_list|length == 1 and region_list.0.0.0 == area.0.name %}
                  {% elif not region_list %}
                  {% else %}
                    <div class="checkbox-list-popup" style="position: absolute; display: none">
                      <table class="checkbox-list-table-1" cellspacing="0" cellpadding="0" border="0">
                      <tbody>
                        {%  for region in region_list %}
                        <tr class="checkbox-list-item-0" >
                          <td class="checkbox-list-checkbox-0">
                            {% ifequal region.1 1 %}
                              <input name="dregion-button-{{ region.0.1 }}" type="checkbox" checked="checked" value="{{ region.0.1 }}" onclick="regionClick(this, 'darea-button-', 'dregion-button-')">
                            {% else %}
                              <input name="dregion-button-{{ region.0.1 }}" type="checkbox" value="{{ region.0.1 }}" onclick="regionClick(this, 'darea-button-', 'dregion-button-')">
                            {% endifequal %}
                          </td>
                          <td class="checkbox-list-label-0">
                            <label onclick="labelClick(this, 1)">{{ region.0.0 }}</label>
                          </td>
                        </tr>
                        {% endfor %}
                      </tbody>
                      </table>
                    </div>
                  {% endif %}
                  </td>
                </tr>
                {% endfor %}
              </tbody>
              </table>
              <!-- Select/Deselect all buttons -->
              <table class="checkbox-list-select-deselect-all" cellspacing="0" cellpadding="0" border="0">
              <tbody>
                <tr>
                  <td class="checkbox-list-select-all">
                    <input type="button" value="Select all" onclick="allClicked(this, 1)">
                  </td>
                  <td class="checkbox-list-deselect-all">
                    <input type="button" value="Deselect all" onclick="allClicked(this, 0)">
                  </td>
                </tr>
              </tbody>
              </table>
            </div>
            <div>
              <input type="submit" value="Change selection" name="submit_regions">
              <input type="submit" value="Reset to default" name="submit_regions">
            </div>

          </div>
        </td>
        <td class="box-middle-row-right">
          <div class="box-middle-row-right"></div>
        </td>
      </tr>
      <tr class="row-collapsed">
        <td class="box-set-lower-row-bottom-left"></td>
        <td class="box-set-lower-row-bottom-middle"></td>
        <td class="box-set-lower-row-bottom-right"></td>
      </tr>
    </tbody>
    </table>

  </div>

  <br>

  <table class="box-main-table" cellspacing="0" cellpadding="0" border="0">
  <tbody>
    <tr>
      <td class="box-upper-row-left"></td>
      <td class="box-upper-row-middle">
        <input type="hidden" value="expanded" name="form:_idJsp45_state">
        <table class="box-header-table" cellspacing="0" cellpadding="0" border="0">
        <tbody>
          <tr>
            <td class="box-label">Current query</td>
            <td>
              <div class="box-button"></div>
            </td>
          </tr>
        </tbody>
        </table>
      </td>
      <td class="box-upper-row-right"></td>
    </tr>
    <tr class="row">
      <td class="box-middle-row-left">
        <div class="box-middle-row-left"></div>
      </td>
      <td class="box-middle-row-middle">
        <div id="form:_idJsp45" class="box-main-text">
          <div>
            <div style="font-weight: bold;">Selected national carriers:</div>
            <i>
              {% if all_nations_selected %}
                all
              {% else %}
                {% for nation in nations %}
                  {% ifequal nation.2 1 %}
                    {{ nation.0 }}<br/>
                  {% endifequal %}
                {% endfor %}
              {% endif %}
            </i>
          </div>
          <div style="margin-top: 5px;">
            <div style="font-weight: bold;">Selected embarkation regions:</div>
            <i>
              {% if all_embarkations_selected %}
                all
              {% else %}
                {% for region_list in export_regions.values %}
                  {% for region in region_list %}
                    {% ifequal region.1 1 %}
                      {{ region.0.0 }}<br/>
                    {% endifequal %}
                  {% endfor %}
                {% endfor %}
              {% endif %}
            </i>
          </div>
          <div style="margin-top: 5px;">
            <div style="font-weight: bold;">Selected disembarkation regions:</div>
            <i>
              {% if all_disembarkations_selected %}
                all
              {% else %}
                {% for region_list in import_regions.values %}
                  {% for region in region_list %}
                    {% ifequal region.1 1 %}
                      {{ region.0.0 }}<br/>
                    {% endifequal %}
                  {% endfor %}
                {% endfor %}
              {% endif %}
            </i>
          </div>
          <div style="margin-top: 5px;">
            <button onclick="return createLink();">Create a link</button> <br/>
            <button onclick="return resetAll();">New query</button>
          </div>
        </div>
      </td>
      <td class="box-middle-row-right">
        <div class="box-middle-row-right"></div>
      </td>
    </tr>
    <tr class="row">
      <td class="box-lower-row-left"></td>
      <td class="box-lower-row-middle"></td>
      <td class="box-lower-row-right"></td>
    </tr>
  </tbody>
  </table>

  <p style="font-style: italic;margin: 10px 10px 0px 10px;">For purposes of calculation, estimates of embarked and disembarked slaves in tables, the timeline, and maps have been rounded. When users cite any number, they are advised to round it to the nearest hundred.</p>
  <div id="dialog" title="Dialog Title" style="display:none;">
    <h1>URL link has been created</h1>
    <hr />
    <p>To reactivate the current query in the future, copy the following URL and then paste it into the address bar:</p>
    <textarea contenteditable="true" id="url_string" style="width:500px;"></textarea>
  </div>

  <link rel="stylesheet" href="//code.jquery.com/ui/1.11.4/themes/smoothness/jquery-ui.css">
  <script src="//code.jquery.com/ui/1.11.4/jquery-ui.js"></script>
  <script type="text/javascript">
    $( "#dialog" ).dialog({ autoOpen: false, minWidth: 550, modal: true, title: "Link created" });
    function createLink() {
      $.post('permalink', $('form').serialize(), function(link) {
        var urlTextArea = $('#url_string');
        urlTextArea.val(link);
        urlTextArea.focus(function(e) {
          e.target.select();
          try {
            document.execCommand('copy');
          } catch (e) {
            console.log('Unable to copy to clipboard using document.execCommand');
          }
          jQuery(e.target).one('mouseup', function(e) {
            e.preventDefault();
          });
        });
        $("#dialog").dialog('open');
      });
      return false;
    }

    function resetAll() {
      var helper = function(name) {
        var input = $("<input>")
          .attr("type", "hidden")
          .attr("name", name)
          .val("Reset to default");
        $('form').append($(input));
      }
      helper('submit_year');
      helper('submit_nation');
      helper('submit_regions');
      $('form').submit();
      return false;
    }
  </script>
</div>